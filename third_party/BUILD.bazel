# TODO(#1532): Rename file to 'BUILD' post-Gradle.
# TODO: Update docs.
"""
This package contains all third-party dependencies that the project depends on. Each maven artifact
should correspond to a single wrapper android_library, and versions should go in versions.bzl.

Note to developers: most new dependencies should go in versions.bzl, not here. In some circumstances
(such as when non-Maven dependencies need to be used) it's appropriate to add additional
dependencies here.

Further, note that not all dependencies can be encapsulated here. For example, Dagger introduces its
own Bazel macros to automatically set up code generation (which includes pulling in external Dagger
dependencies).
"""

load(
    "//third_party:load_utilities.bzl",
    "create_direct_import_dependency_wrappers",
    "create_maven_dependency_wrappers",
)
load(":versions.bzl", "DIRECT_REMOTE_DEPENDENCIES", "MAVEN_ARTIFACT_TREES")
load("//third_party/tools/glide:plugin_setup.bzl", setUpGlidePlugin = "setUp")
load("//third_party/tools/moshi:plugin_setup.bzl", setUpMoshiPlugin = "setUp")

package_group(
    name = "app_prod_artifact_visibility",
    includes = [
        "//:oppia_api_visibility",
    ],
)

package_group(
    name = "app_test_artifact_visibility",
    includes = [
        "//:oppia_testing_visibility",
    ],
)

create_maven_dependency_wrappers(
    direct_prod_dependencies = MAVEN_ARTIFACT_TREES["deps"]["prod"]["direct"],
    direct_test_dependencies = MAVEN_ARTIFACT_TREES["deps"]["test"]["direct"],
    maven_repository_name = "maven_app",
    prod_artifact_visibility = [":app_prod_artifact_visibility"],
    test_artifact_visibility = [":app_test_artifact_visibility"],
)

create_direct_import_dependency_wrappers(
    dependency_imports_details = DIRECT_REMOTE_DEPENDENCIES,
    maven_artifact_visibility = ["@maven_app//:__pkg__"],
    prod_artifact_visibility = [":app_prod_artifact_visibility"],
    test_artifact_visibility = [":app_test_artifact_visibility"],
)

setUpMoshiPlugin(
    name = "moshi",
    moshi_compiler_dep = "//third_party:com_squareup_moshi_moshi-kotlin-codegen",
    moshi_exported_library = "//third_party:com_squareup_moshi_moshi-kotlin",
    visibility = [":app_prod_artifact_visibility"],
)

setUpGlidePlugin(
    name = "glide_compiler",
    glide_compiler_dep = "//third_party:com_github_bumptech_glide_compiler",
    visibility = [":app_prod_artifact_visibility"],
)
